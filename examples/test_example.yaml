test:
  name: "User Management Example"
  description: |
    A simple example test that demonstrates the llm-pytest framework
    by testing a hypothetical user management API.

    Note: This example uses a fictional 'user_api' plugin.
    In real tests, you would create this plugin in tests/llm/plugins/.
  tags: ["example", "api"]
  timeout: 60

steps:
  - name: "Create a new user"
    tool: user_api_create
    args:
      name: "Alice"
      email: "alice@example.com"
    save_as: created_user
    expect: |
      The response should contain:
      - A newly created user with an ID
      - The name and email we provided
      - A created_at timestamp
    analyze: |
      Check the returned user data:
      1. Is there a valid numeric ID?
      2. Does the name match "Alice"?
      3. Is the email properly formatted?
      4. Is created_at a valid timestamp?

  - name: "Fetch the created user"
    tool: user_api_get
    args:
      user_id: ${created_user.id}
    save_as: fetched_user
    expect: |
      The fetched user should match the created user:
      - Same ID, name, and email
      - The data should be consistent

  - name: "Store user ID for later"
    tool: store_value
    args:
      name: "test_user_id"
      value: ${created_user.id}
    expect: "Value should be stored successfully"

  - name: "Verify stored value"
    tool: get_value
    args:
      name: "test_user_id"
    expect: "Should return the stored user ID"

verdict:
  pass_if: |
    - User was created with valid data
    - Fetched user matches created user
    - State persistence works correctly

  fail_if: |
    - User creation failed
    - Data inconsistency between create and fetch
    - State persistence failed
